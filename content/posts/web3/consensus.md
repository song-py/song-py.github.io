+++
title = '共识算法'
date = 2024-07-09T12:24:19+08:00
draft = true
tags = ['web3', 'selenium']
+++

共识算法是一种用在分布式过程或系统中，实现单一数据值的协议，对于区块链这样的分布式系统中至为重要。

主要有下面这些算法：

## 工作量证明（PoW，Proof of Work）

- 优点： 安全性高。
- 不足：耗能巨大，速度慢。
- 使用者： Bitcoin、 Ethereum(1.0)、 Litecoin、 Conflux、 Dogecoin等。
- 算法简介：PoW是是首个共识算法。它是由中本聪在他的论文中提出的，用于建立分布式无信任共识并识别“双重支付”（double spend）问题。PoW并非一个新理念，但是中本聪将Pow与加密签  名、Merkle链和P2P网络等已有理念结合，形成一种可用的分布式共识系统。加密货币是这样系统的首个基础和应用，因而独具创新性。在PoW的工作方式中，区块链参与者（称为“矿工”）要在区块链中添加一块交易，必须解决某种“复杂但是无用”的计算问题。只要由矿工提交的工作有超过一半是值得信任的，那么Bitcoin就是安全的。从某种角度来看，PoW有点像买彩票，只是概率高一点而已。
- 技术原理：
工作量证明最核心的技术原理是散列函数（哈希）。在比特币中，PoW工作其实就是如何去计算一个区块的目标哈希值问题，让用户进行大量的穷举运算，同时得出这个哈希值还必须满足一些必要条件，这个条件在区块链中其实就是一个难度系数值，通过计算出的哈希值是否符合前面N位全是0，最终达成工作量证明。

## 权益证明（PoS，Proof of Stake）

- 优点：节能、攻击者代价更大、不易受“规模经济”的影响。
- 不足：“无利害关系“（Nothing at stake）”攻击问题。
- 使用者：ETH2.0、 Peercoin，Cardana，Avalanche，Algorand等。
- 算法简介：
2011 年，Quantum 在 Bitcointalk 论坛上提出。2012 年 8 月，首个基于 PoS 共识的区块链项目点点币（Peercoin）诞生，点点币（Peercoin）是第一个实现 PoS 算法的应用。点点币中权益即为币龄，币龄是节点所持币的数量与其持有时间的乘积，发起交易会消耗一定的币龄，每消耗一定币龄时也将获得利息
- 技术原理：
 每个旷工都有出块(即挖矿)的权力，只要出块成功，就有系统给出的奖励，这里不需要通过复杂的计算来挖矿，问题只在于谁来出块，股权越大，出块的概率就越大，反之，则相反。POS有很多变种，股权可以是持有币的数量，或者支付的数量等等。

## 延迟工作量证明（dPoW，Delayed Proof-of-Work）

- 优点： 节能、安全性增加、可以通过非直接提供 Bitcoin（或是其它任何安全链），添加价值到其它区块链，无需付出 Bitcoin（或是其它任何安全链）交易的代价。
- 不足： 只有使用 PoW 或 PoS 的区块链，才能采用这种共识算法。
- 使用者：Komodo
- 算法简介：Komodo是首个使用该共识方法的区块链，它就是附加于 Bitcoin 区块链之上的。使用 dPoW 的区块链也可以使用 PoW 或 PoS 共识方法工作，并可以附加在任何采用 PoW 的区块链上。但对于由 dPoW 提供安全的区块链，当前 Bitcoin 给出了最高安全层级的哈希率。
- 技术原理：dPoW 是一种混合共识方法，允许一个区块链利用第二个区块链的哈希算力（Hashing Power）所提供的安全。该机制是通过一组公证员节点（Notary Node）实现的。公证员节点实现将第一个区块链的数据添加到第二个区块链中。进而，第二个区块链请求在两个区块链间达成妥协，弱化第一个区块链的安全。
dPoW 系统中有两种类型的节点：公证人节点和正常节点。64 个公证人节点是由 dPoW 区块链的权益持有者（stakeholder）选举产生的，它们可从 dPoW 区块链向所附加的 PoW 区块链添加经公证确认的块。一旦添加了一个块，该块的哈希值将被添加到由 33 个公证人节点签署的 Bitcoin 交易中，并创建一个哈希到 Bitcoin 区块链的 dPow 块记录。该记录已被网络中的大多数公证人节点公证。

## 委任权益证明（DPOS，Delegated Proof-of-Stake）

- 优点： 节能、快速、便宜的交易。
- 不足： 部分中心化、拥有高权益的参与者可投票使自己成为一名验证者。
- 使用者：BitShares、Steemit、EOS、Lisk、Ark。
- 算法简介：在 DPoS 系统中，权益持有者可以选举领导者（或称为见证人，Witness）。经权益持有者授权，这些领导者可进行投票。该机制使得 DPoS 要快于正常的 PoS。
  通常，所有节点采用轮询方式，一次生成一个区块。该机制防止一个节点发布连续的块，进而执行“双重支付”攻击。如果一个见证人在分配给他的时间槽中未生成区块，那么该时间槽就被跳过，并由下一位见证人生成下一个区块。如果见证人持续丢失他的区块，或是发布了错误的交易，那么权益持有者将投票决定其退出，用更好的见证人替换他。

  DPoS和PoS有很大的不同：
  - DPoS中，代币持有者不会对区块本身的有效性进行投票，而是投票选举代表，代表他们进行验证。
  - DPoS通常有21-100名代表，代表会定期进行洗牌，会收到交付其区块的命令。
  - 代表数较少可以让他们有效地组织起来，为每个代表创建制定的时间段来发布他们的区块。
  - 如果代表不断错过他们的区块或发布无效交易，利益相关者就会投票淘汰他们，并用更好的代表取代他们。
  - 在 DPoS 中，矿工可以合作出块，而不是像 PoW 和 PoS 那样竞争。通过部分集中化区块的创建，DPoS 的运行速度比大多数其他共识算法快几个数量级。
- 技术原理：
 假设n为21，竞选的节点有几百个，持币人对这些节点进行投票，选出票数最多的21位，由这21位轮流来出块。

## 权威证明（PoA，Proof-of-Authority）

- 优点：节能、快速，适用于专用网络。
- 不足：比较中心化。
- 使用者：POA.Network、Ethereum Kovan Testnet、xDai、VeChain。
- 算法简介：基于 PoA 的网络、事务和区块，是由一些经认可的账户认证的，这些被认可的账户称为“验证者”（Validator）。验证者运行的软件，支持验证者将交易（transaction）置于区块中。该过程是自动的，无需验证者持续监控计算机，但需要维护计算机（权威节点）不妥协（uncompised）。

验证者必须满足以下三个条件：

 1. 其身份必须在链上得到正式验证，信息可在公有可用域中交叉验证。
 2. 其资格必须难以获得，这样所得到的验证块的权利才弥足珍贵（例如，潜在的验证者需要获得公证书）。
 3. 建立权威的检查和程序必须完全统一。

## 历史证明（PoH，Proof of History）

- 使用者：Solana
- 算法简介：其基本理念是不相信交易中的时间戳，而是证明交易在某个事件之前或之后的某个时刻发生。
- 技术原理：
PoHistory 是一种高频可验证延迟函数（VDF，Verifiable Delay Function）。VDF 求值需要完成特定数量的顺序步骤，然后生成一个唯一的输出。该输出可被高效地和公开地验证。
VDF 的一个特定实现使用了持续运行于其上的顺序抗预映射哈希（Pre-image Resistant Hash），其中前一次循环生成的输出将用于下一次循环的输入。计数和当前输出形成周期性记录。
因此我们可以确认，每个计数器在生成过程中都的确经历了一定的时间。进而，每个计数器记录的顺序与实时情况是一致的。

## 拜占庭容错（PBFT，Practical Byzantine Fault Tolerance）

- 优点：高速、可扩展。
- 不足：通常用于私有网络和许可网络。
- 使用者：HyperLedger Fabric(<1.0 版本), Stellar, Ripple 和 Dispatch
- 算法简介：拜占庭将军问题是分布式计算中的一个经典问题。问题描述为，几位拜占庭将军分别率领部队合力包围了一座城市。他们必须一致决定是否发起攻城。如果一些将军在没有其他将军参与的情况下决定发起攻城，那么他们的行动将以失败告终。将军们之间相互隔着一定的距离，必须依靠信息传递进行交流。
  
实用拜占庭容错（PBFT，Practical Byzantine Fault Tolerance）：首个提出的该问题解决方案称为“实用拜占庭容错”（PBFT），当前已被 Hyperledger Fabric 采用。PBFT 使用了较少（少于 20 个，之后会稍有增加）的预选定将军数，因此运行非常高效。

- 技术原理：PBFT基于拜占庭将军问题，一致性的确保主要分为这三个阶段：预准备（pre-prepare）、准备(prepare)和确认(commit)。
  - Pre-prepare：负责执行区块，产生签名包，并将签名包广播给所有共识节点；
  - Prepare：负责收集签名包，某节点收集满2*f+1的签名包后，表明自身达到可以提交区块的状态，开始广播Commit包；
  - Commit：负责收集Commit包，某节点收集满2*f+1的Commit包后，直接将本地缓存的最新区块提交到数据库。

## 授权拜占庭容错算法（dBFT，Delegated Byzantine Fault Tolerance）

- 优点：快速、可扩展。
- 不足：每个人都争相成为根链。其中可能存在多个根链。
- 使用者：Neo。
- 算法简介：授权拜占庭容错算法，简称 dBFT，是一种支持通过代理投票实现大规模参与共识的拜占庭容错共识算法。在 Neo 中，令牌持有者可以通过投票选取其支持的 bookkeeper。之后，选定的 bookkeeper 组采用 BFT 算法达成共识，并生成新区块。Neo 网络中的投票是实时的，而非因人而异的。

dBFT 可为具有个共识节点的共识系统提供容错。这种容错也涵盖了安全性和可用性、不受将军和拜占庭错误影响，并且适合任何网络环境。dBFT 具有很好的最终性（finality），这意味着一旦最终确认，区块将不可分叉，交易将不可再撤销或是回滚。

## 容量证明（PoC，Proof of Capacity）

- 优点：它类似于 PoW，只是使用空间替代了计算。可用于恶意软件检测。
- 不足：激励机制可能存在问题。
- 使用者： Butcoin、Chia、SpaceMint。
- 算法简介：通过分配一定数量的内存或磁盘空间用于解决服务提供者所提供挑战的方式，显示了某个人对某个服务（例如发送邮件）具有合法的兴趣。该理念是由 Dziembowski 等在 2015 年形式化定义的。虽然 Ateniese 等人的论文名称也是“Proof-of-space”，但它事实上一种采用 MHF（Memory Hard Function，一种计算代价取决内存的哈希算法）的 PoW 协议。

PoS 非常类似于 PoW，只是使用存储替代了 Pow 中的计算。PoS 与 MHF 和可回收性证明（PoR，Proof of Retrievability）有关，但也在很大程度上存在着差异。

PoS 是由证明者 （Prover） 发送给验证者 （Verifier） 的一小块数据，该数据确认了证明者已经保留了一定量的空间。出于实用性上的考虑，验证过程需要尽量高效，即消耗尽可能少的空间和时间。出于公平性上的考虑，如果验证者没有保留所声明数量的空间，那么它应该难以通过验证。PoS 的一种实现方式是通过使用一个难以实现 Pebbling 的图。验证者请求证明者构建对一个“非 Pebbling 图”标记。证明者提交标记，进而验证者请求证明者在提交中开放多个随机位置。

由于存储的通用本质，以及存储所需的更低耗能，PoS 被认为是一种更公平、更绿色的替换方法。

此外还有一些其他共识算法
